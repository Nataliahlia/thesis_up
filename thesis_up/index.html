<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Πρόγραμμα Παρουσιάσεων Διπλωματικών Εργασιών</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon_32x32.png">
    <!-- Bootstrap CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../style.css" />
    <style>
        :root {
            --bordeaux-primary: #6A1F2B;
            --bordeaux-secondary: #800000;
            --bordeaux-light: rgba(106, 31, 43, 0.1);
            --bordeaux-glass: rgba(106, 31, 43, 0.15);
        }

        body {
            background: linear-gradient(135deg, #6A1F2B 0%, #800000 50%, #5a1a25 100%) !important;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1),
                        0 0 0 1px rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 2;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            z-index: 1030;
        }

        .text-bordeaux {
            color: var(--bordeaux-primary);
        }

        .bordeaux-outline {
            border: 2px solid var(--bordeaux-primary);
            background: rgba(255, 255, 255, 0.9);
        }

        .btn-bordeaux, .btn-outline-bordeaux {
            background: linear-gradient(45deg, var(--bordeaux-primary), var(--bordeaux-secondary));
            border: none;
            color: white;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(106, 31, 43, 0.3);
        }

        .btn-bordeaux:hover, .btn-outline-bordeaux:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(106, 31, 43, 0.4);
            color: white;
        }

        .card {
            min-width: 350px;
            margin: 0.5rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .container-scrollable {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 20px 0;
        }

        .container-scrollable::-webkit-scrollbar {
            display: none;
        }

        .form-control {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(106, 31, 43, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--bordeaux-primary);
            box-shadow: 0 0 0 0.2rem rgba(106, 31, 43, 0.25);
        }

        .section-title {
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .export-buttons {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .main-content {
            position: relative;
            z-index: 2;
            margin-top: 2rem;
        }

        /* Custom alert modal styles */
        .custom-alert-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .custom-alert-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .filter-section, .export-buttons {
                margin: 1rem;
                padding: 1.5rem;
                border-radius: 15px;
            }

            .card {
                min-width: 280px;
            }
        }
    </style>
</head>
<body>

    <!-- Create a navigation bar using Bootstrap -->
    <nav class="navbar navbar-expand-lg border-bottom" id="navbarContainer">
        <div class="container-fluid">
            <!-- Brand -->
            <a class="navbar-brand" href="#">
            <img id="logo" src="new_logo_crop.png" class="img-fluid" style="height: 40px; width: auto;">
            </a>
            
            <!-- Login always visible -->
            <a href="/login" class="btn btn-bordeaux ms-auto d-lg-none d-block" type="button">
                <i class="fas fa-sign-in-alt me-2"></i>Login
            </a>

            <!-- Collapse menu -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <!-- links αν χρειάζεσαι -->
            </ul>
            <!-- Login visible on desktop -->
            <a href="/login" class="btn btn-bordeaux ms-auto d-none d-lg-block" type="button">
                <i class="fas fa-sign-in-alt me-2"></i>Login
            </a>
            </div>
        </div>
    </nav>

    <div class="main-content" style="margin-left: 0; transition: margin-left 0.3s ease; width: 100%;">
        <h1 class="section-title fade-in-up">
            Τρέχουσες Ανακοινώσεις Διπλωματικών Εργασιών
        </h1>
        
        <div class="glass-container mx-auto" style="max-width: 95%; padding: 2rem;">
            <div class="carousel-wrapper mt-3">
                <div class="carousel-track container-scrollable" id="carouselContainer">
                    <!-- Cards will go here -->
                </div>
            </div>
        </div>

        <!-- Custom Alert Modal -->
        <!-- Background overlay -->
        <div id="customAlert" class="custom-alert-backdrop" style="display: none;">
            <div class="custom-alert-content">
                <!-- The message that will be displayed in the alert, it can be customized dynamically -->
                <h5 id="customAlertMessage" class="text-center mb-4 text-bordeaux">Μήνυμα</h5>
                <div class="text-center">
                    <!-- The button that will close the alert -->
                    <button id="customAlertOk" class="btn btn-bordeaux">
                        <i class="fas fa-check me-2"></i>OK
                    </button>
                </div>
            </div>
        </div>

        <div class="filter-section fade-in-up">
            <div class="row justify-content-center">
                <div class="col-auto">
                    <button id="timeRangeButton" type="submit" class="btn btn-bordeaux">
                        <i class="fas fa-calendar-alt me-2"></i>Διαμόρφωση Εύρους Χρόνου
                    </button>
                </div>
            </div>

            <!-- This stays hidden until the button is pressed -->
            <div class="row justify-content-center mt-4" id="dateRangeFilter" style="display: none;">
                <div class="col-md-8 col-lg-6">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="startDate" class="form-label text-bordeaux fw-bold">
                                <i class="fas fa-calendar-alt me-2"></i>Από:
                            </label>
                            <input type="date" id="startDate" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="endDate" class="form-label text-bordeaux fw-bold">
                                <i class="fas fa-calendar-alt me-2"></i>Έως:
                            </label>
                            <input type="date" id="endDate" class="form-control">
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="applyFiltersBtn" class="btn btn-bordeaux">
                            <i class="fas fa-filter me-2"></i>Εφαρμογή Φίλτρων
                        </button>
                    </div>                     
                </div>
            </div>
        </div>

        <div class="export-buttons fade-in-up" id="exportFilter" style="display: none;">
            <div class="row justify-content-center">
                <div class="col-auto">
                    <h5 class="text-bordeaux fw-bold mb-3 text-center">
                        <i class="fas fa-download me-2"></i>Εξαγωγή Δεδομένων
                    </h5>
                    <div class="d-flex flex-wrap gap-3 justify-content-center">
                        <button id="jsonFile" type="submit" class="btn btn-bordeaux">
                            <i class="fas fa-file-code me-2"></i>Εξαγωγή σε JSON
                        </button>
                        <button id="xmlFile" type="submit" class="btn btn-bordeaux">
                            <i class="fas fa-file-alt me-2"></i>Εξαγωγή σε XML
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer border-top text-center text-lg-start mt-5">
        <div class="text-center p-4"> 
            <!-- Span used to apply the css class for styling to the footer text only -->
            <span class="text-white fw-bold">© 2025 Πανεπιστήμιο Πατρών</span>
            <a class="text-white ms-3" href="https://www.upatras.gr/" target="_blank">
                <i class="fas fa-external-link-alt me-1"></i>www.upatras.gr
            </a>
        </div>
    </footer>
    
<script>
    let filteredAnnouncements = []; // Variable to store filtered announcements, used to extract JSON and XML
    let animationFrameId = null;    // Variable to store the ID of the animation frame, to see if there is an animation that is running and be able to stop it
    document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById('carouselContainer');

        fetch('/api/announcements')
            .then(response => response.json())
            .then(announcements => {
                // Check if the response is an array, else return an error
                if (!Array.isArray(announcements)) {
                    console.error("Invalid data from server");
                    return;
                }

                container.style.display = 'flex';               // The container is displayed as flex, means the cards will be displayed in a row
                container.style.justifyContent = 'flex-start';  // The cards will be aligned to the left
                container.style.alignItems = 'initial';         // The cards will not be stretched

                // Check if announcements array is empty
                if (announcements.length === 0) {
                    handleNoAnnouncements(container);  // Call the function to handle no announcements 
                    return;                            // Exit if there are no announcements
                }   

                cardCreate(container, announcements);  // Create announcement cards
                startScrolling(container);             // Start the scrolling effect
            })
            .catch(err => {
                console.error("Fetch error:", err);
            });
    });

    let pressed = 0; // Variable to track if the button has been pressed before

    // This part handles the press of the button to show the date range filter
    document.getElementById('timeRangeButton').addEventListener('click', () => {
        const dateRangeFilter = document.getElementById('dateRangeFilter'); // Get the date range filter element, in order to be able to display it 
        dateRangeFilter.style.display = 'flex';     // The container is displayed as flex, means the cards will be displayed in a row
        pressed += 1; // Add one to the pressed state
        if (pressed >= 1) {
            enableExaminationEdit(); // If the button is pressed for the second time we are now editing the date time and not just setting them 
        }
    });

    // This part handles the application of the filters
    document.getElementById("applyFiltersBtn").addEventListener("click", () => {
        const start = document.getElementById("startDate").value;
        const end = document.getElementById("endDate").value;
        const container = document.getElementById("carouselContainer");
        const jsonFile = document.getElementById("jsonFile");
        const xmlFile = document.getElementById("xmlFile");

        // If no start or end date is selected, show an alert
        if (!start || !end) {
            showCustomAlert("Επιλέξτε και τις δύο ημερομηνίες.");
            return;
        }
        
        // Convert to Date objects for comparison
        const startDateObj = new Date(start);
        const endDateObj = new Date(end);

        // If the start date is after the end date, show an alert
        if (startDateObj > endDateObj) {
            showCustomAlert("Η ημερομηνία έναρξης πρέπει να είναι πριν ή ίση με την ημερομηνία λήξης.");
            return;
        }

        lockExaminationFields(); // Lock the fields after submission
        // Show the export buttons
        document.getElementById("exportFilter").style.display = 'block'; // Show the parent container
        jsonFile.style.display = 'inline-block';
        xmlFile.style.display = 'inline-block';

        // Fetch announcements based on the selected date range
        fetch(`/api/announcements?start=${start}&end=${end}`)
                .then(response => response.json())
                .then(announcements => {
                    if (!Array.isArray(announcements)) {
                        console.error("Invalid data from server");
                        return;
                    }
                
                    filteredAnnouncements = announcements;
                    container.innerHTML = ""; // Clear the container before adding new cards
                    // This is if there are no announcements in the selected dates 
                    if (announcements.length === 0) {
                        handleNoAnnouncements(container);
                        return;
                    }

                    cardCreate(container, announcements);  // Create announcement cards
                    // If the animation is already running, restart it with the new cards
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }
                    startScrolling(container);              // Start the scrolling effect
                })
                .catch(err => {
                    console.error("Fetch error:", err);
                });
    });

    // Function that handles the non existance of announcements
    function handleNoAnnouncements(container) {
            const start = document.getElementById("startDate").value;
            const end = document.getElementById("endDate").value;
            container.style.display = 'flex';
            container.style.justifyContent = 'flex-start';
            container.style.alignItems = 'initial';

            // Create static "no announcements" card
            container.style.display = 'flex';
            container.style.justifyContent = 'center';
            container.style.alignItems = 'center';

            // This is the styling of the cards, that is according to the other cards
            const noAnnouncementsCard = document.createElement('div');
            noAnnouncementsCard.className = 'card shadow-sm';
            noAnnouncementsCard.style.flex = '0 0 auto';
            noAnnouncementsCard.style.minWidth = '250px';
            noAnnouncementsCard.style.width = '400px';
            noAnnouncementsCard.style.height = '250px';
            noAnnouncementsCard.style.marginRight = '2rem';
            noAnnouncementsCard.style.display = 'flex';
            noAnnouncementsCard.style.flexDirection = 'column';
            noAnnouncementsCard.style.justifyContent = 'center';
            noAnnouncementsCard.style.alignItems = 'center';
            noAnnouncementsCard.style.textAlign = 'center';
            noAnnouncementsCard.style.padding = '1rem';

            // Create a div that will hold the card, if there are dates that where selected, we display them 
            noAnnouncementsCard.innerHTML = `
                <div class="card-body text-center d-flex flex-column justify-content-between align-items-center h-100" style="padding: 1rem; white-space: normal; overflow-wrap: break-word; word-break: break-word; max-width: 100%;">
                    <h4 class="card-title text-bordeaux">Δεν Βρέθηκαν Αποτελέσματα</h4>
                    <p class="card-text text-muted">
                        Δεν υπάρχουν ανακοινώσεις διπλωματικών εργασιών για το συγκεκριμένο χρονικό διάστημα.
                    </p>
                    ${
                        start && end
                            ? `<p class="card-text">
                                <small class="text-muted">Εύρος: ${start} έως ${end}</small>
                                </p>`
                            : ""
                    }
                </div>
            `;
            container.appendChild(noAnnouncementsCard); // The card is added to the container
        }

    // Function that starts the scrolling effect
    function startScrolling(container) {
        const originalContent = container.innerHTML;    // Store the original content of the container
        const containerWidth = container.clientWidth;   // Get the width of the container
        let currentWidth = container.scrollWidth;       // Get the current width of the content inside the container
        const isMobile = window.innerWidth <= 768;      // Check if the screen is mobile size

        // Repeat the content until it fills at least 3 times the container width
        while (currentWidth < containerWidth * 3) {
            container.innerHTML += originalContent;
            currentWidth = container.scrollWidth;
        }

        // If its a mobile device, we set the overflow to auto, so the user can scroll manually
        if (isMobile) {
            container.style.overflowX = 'auto';
            return;
        }

        // If the width of the content is greater than the width of the container, start the scrolling effect
        if (container.scrollWidth > containerWidth) {
            let scrollSpeed = 1;

            // This function will scroll the content of the container, each frame moves 1 pixel
            function smoothScroll() {
                container.scrollLeft += scrollSpeed;
                // When the scroll position reaches the halfway point of the content, reset it to 0
                if (container.scrollLeft >= container.scrollWidth / 2) {
                    container.scrollLeft = 0;
                }
                animationFrameId = requestAnimationFrame(smoothScroll);     // Recursive call
            }
            requestAnimationFrame(smoothScroll);    // This is what starts the scrolling
        } else {
            console.log('Not enough content to scroll');
        }
    }

    // Function that creates the cards
    function cardCreate(container, announcements) {
        // First we define the container
        container.innerHTML = "";
        container.style.display = 'flex';
        container.style.justifyContent = 'flex-start';
        container.style.alignItems = 'initial';

        // Create one card for each announcement object
        announcements.forEach(announcement => {
            const card = document.createElement('div');
            // Define the class of the card, so it has the same styling as the other cards
            card.className = 'card shadow-sm mx-2';
            card.style.flex = '0 0 auto';
            card.innerHTML = `
                <div class="card-body d-flex flex-column justify-content-between h-100">
                    <p class="card-title text-bordeaux">${announcement.thesis_title}</p>
                    <div class="mt-auto">
                        <p class="card-text mb-0">${announcement.student_full_name}</p>
                        <p class="card-text mb-0">Ημέρα και ώρα: ${announcement.date.split('T')[0]} στις ${announcement.time}</p>
                        <p class="card-text mb-0">Παρουσιάζεται: ${announcement.location_or_link}</p>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }
    
    // Function for the successful submission of the thesis
    function lockExaminationFields() {
        const fields = ['startDate', 'endDate']; // Array with the forms 'fields
        // Loop through the fields and disable them, also add styling
        fields.forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.setAttribute('disabled', true);       // Disable so the user cannot change it
                input.classList.add('bordeaux-outline');    // Add styling to the disabled button
            }
        });

        document.querySelector('#applyFiltersBtn').style.display = 'none';  // Hide the button
    }

    // Function to edit the examination details
    function enableExaminationEdit() {
        const fields = ['startDate', 'endDate']; // Array with the forms 'fields
        // Loop through the fields and disable them, also add styling
        fields.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.disabled = false;                        // Enable the button again
                el.classList.remove('bordeaux-outline');    // Remove the styling for the disabled button 
            }
        });

        document.querySelector('#applyFiltersBtn').style.display = 'block';  // Show the button again
    }

    // Function to show a custom alert modal
    function showCustomAlert(message) {
        const modal = document.getElementById('customAlert');               // Reference to the custom alert modal backdrop
        const messageBox = document.getElementById('customAlertMessage');   // Reference to the message box inside the modal
        const okBtn = document.getElementById('customAlertOk');             // Reference to the OK button inside the modal

        messageBox.textContent = message;       // Set the message text
        modal.style.display = 'flex';           // Show the modal by changing its display to flex

        // Hide the modal when OK is clicked
        okBtn.onclick = () => {
            modal.style.display = 'none';
        };
    }

    // This handles the JSON file creation 
    document.getElementById("jsonFile").addEventListener("click", () => {
        // This keeps only the date part of the string
        const simplified = filteredAnnouncements.map(a => ({
            ...a,
            date: a.date.split('T')[0] 
        }));

        const json = JSON.stringify(simplified, null, 2);   // Convert the filtered announcements to JSON format
        const blob = new Blob([json], { type: "application/json" });    // Create a blob object for the JSON file
        const url = URL.createObjectURL(blob);      // Create a temporary URL for the blob object
        const link = document.createElement("a");   // Create a link element
        link.href = url;                            // href of the link is set to the blob URL, in order to specify the file to download
        link.download = "announcements.json";       // Name the file
        link.click();                               // This is used in order to start the download
        URL.revokeObjectURL(url);                   // Revoke the object URL to free up memory
    });

    document.getElementById("xmlFile").addEventListener("click", () => {
        const xmlData = jsonToXml(filteredAnnouncements);   // Convert the filtered announcements to XML format
        const blob = new Blob([xmlData], { type: "application/xml" });    // Create a blob object for the XML file
        const url = URL.createObjectURL(blob);      // Create a temporary URL for the blob object
        const link = document.createElement("a");   // Create a link element
        link.href = url;                            // href of the link is set to the blob URL, in order to specify the file to download
        link.download = "announcements.xml";       // Name the file
        link.click();                               // This is used in order to start the download
        URL.revokeObjectURL(url);                   // Revoke the object URL to free up memory
    });

    // Function used to convert JSON to XML format
    function jsonToXml(jsonArray) {
        let xml = '<?xml version="1.0" encoding="UTF-8"?>\n<announcements>\n';        // This is the header of the XML file
        jsonArray.forEach(item => {
            xml += `  <announcement>\n`;    // A new xml element is created
            // Loop through each key in the item and create an XML element for it
            for (const key in item) {
                let value = item[key];
                // For the date, we only want the date part
                if (key === 'date' && typeof value === 'string') {
                    value = value.split('T')[0];
                }
                xml += `    <${key}>${value}</${key}>\n`;
            }
            xml += `  </announcement>\n`;   // Close the announcement element
        });
        xml += '</announcements>';  // Close the root element
        return xml; // Return the XML string
    }

</script>

</body>
</html>

<!-- // Κλωνοποιούμε το περιεχόμενο για ατέρμονη κύλιση
//  container.innerHTML += container.innerHTML;
// let scrollSpeed = 1;
// function smoothScroll() {
//   container.scrollLeft += scrollSpeed;
//   const halfScroll = container.scrollWidth / 2;
//   if (container.scrollLeft >= halfScroll) {
//     container.scrollLeft = 0; // μικρό reset, αλλά επειδή το περιεχόμενο είναι διπλό, δεν γίνεται αντιληπτό
//   }
//   animationFrameId = requestAnimationFrame(smoothScroll);
// }
// requestAnimationFrame(smoothScroll); -->